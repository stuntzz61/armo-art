server {
  listen 80;
  server_name armo-art.ru www.armo-art.ru;

  root /usr/share/nginx/html;
  index index.html;

  types {
    text/html               html htm shtml;
    text/css                css;
    text/xml                xml;
    image/gif               gif;
    image/jpeg              jpeg jpg;
    image/png               png;
    image/webp              webp;
    image/svg+xml           svg svgz;
    application/javascript  js mjs;
    text/jsx                jsx;
  }

  gzip on;
  gzip_types text/plain text/css application/javascript application/json image/svg+xml;

  # SPA: любые маршруты падают на index.html
  location / {
    try_files $uri $uri/ /index.html;
  }

  # Картинки можно кэшировать
  location ~* \.(?:jpg|jpeg|png|gif|ico|webp|svg)$ {
    expires 30d;
    add_header Cache-Control "public" always;
    try_files $uri =404;
  }

  # В разработке отключаем кэш для html/js/jsx
  location = /index.html {
    expires 0;
    add_header Cache-Control "no-store, must-revalidate" always;
  }
  location ~* \.(?:css|js|mjs|jsx)$ {
    expires 0;
    add_header Cache-Control "no-store, must-revalidate" always;
    try_files $uri =404;
  }

  # Редирект на https, если фронт-прокси прислал http
  if ($http_x_forwarded_proto = "http") {
    return 301 https://$host$request_uri;
  }
}
